## 🎓 배경 지식 (Context)

Stage 3는 Stage 1에서 추출한 메타데이터를 바탕으로 표준화된 파일명을 생성하는 단계입니다. `rules.yml`에 정의된 규칙에 따라 제목/화수/상태/별점/장르/작가/태그를 조합하여 새 파일명을 만들고, 검수용 매핑 파일을 출력합니다.

## 🎯 목표 (Goal)

1. rules.yml 기반 파일명 규칙 엔진 구현
2. 제목/화수/상태/별점/장르/작가/태그 정규화
3. 금지 문자 제거 및 길이 제한
4. 검수용 매핑 파일 생성 (`data/mapping_result_*.txt`)
5. DB 저장 (rename_plan 테이블)

## 🛠️ 기술적 계획 (Technical Plan)

### 구현된 모듈

#### `src/novel_total_processor/stages/stage3_filename.py`
- **FilenameGenerator 클래스**:
  - `generate_filename()`: 메타데이터 → 새 파일명 생성
  - `_normalize_title()`: 제목 정규화 (접두사/접미사 제거, 길이 제한)
  - `_format_episode_status()`: "1~340화_완결" 형식
  - `_format_rating()`: "★4.5" 형식
  - `_normalize_genre()`: 장르 매핑 (판타지/로맨스 등)
  - `_normalize_author()`: 작가명 정규화
  - `_format_tags()`: 우선순위 태그 정렬 (최대 3개)
  - `_sanitize_filename()`: 금지 문자 제거 (`<>:"/\|?*`)
  - `_truncate_filename()`: 길이 제한 (200바이트)
  - `save_rename_plan()`: rename_plan 테이블 저장
  - `generate_mapping_file()`: 검수용 매핑 파일 생성

### 파일명 형식
```
제목__화수_상태__★별점__장르__작가__태그.ext
```

예시:
```
전지적 독자 시점__1~551화_완결__★4.8__판타지__싱숑__19금,베스트,완결.txt
```

### 검수용 매핑 파일
```
data/mapping_result_20260212_082232.txt

원본파일명.txt
  → 새파일명__1~340화_완결__★4.5__판타지__작가명.txt
```

## ✅ 완료 조건 (Definition of Done)

- [x] FilenameGenerator 클래스 구현
- [x] 제목/화수/상태/별점/장르/작가/태그 정규화 로직
- [x] 금지 문자 제거 및 길이 제한
- [x] rename_plan 테이블 저장
- [x] 검수용 매핑 파일 생성
- [x] 테스트 스크립트 작성

## 📝 진행 기록

| 날짜 | 내용 |
|:---|:---|
| 2026-02-12 | 이슈 생성 |
| 2026-02-12 | FilenameGenerator 구현 완료 |
