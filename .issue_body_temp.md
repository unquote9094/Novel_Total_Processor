## 🎓 배경 지식 (Context)

Stage 0는 Novel Total Processor 파이프라인의 첫 단계로, 여러 폴더에 흩어진 소설 파일들을 스캔하고 데이터베이스에 등록합니다. XXHash를 사용한 빠른 해싱과 중복 파일 감지 기능을 포함합니다.

## 🎯 목표 (Goal)

1. 다중 폴더 재귀 스캔 (TXT/EPUB 파일)
2. XXHash 기반 빠른 해시 계산
3. chardet을 이용한 인코딩 자동 감지 (TXT 파일)
4. 중복 파일 감지 및 그룹화
5. DB 저장 및 processing_state 초기화

## 🛠️ 기술적 계획 (Technical Plan)

### 구현된 모듈

#### `src/novel_total_processor/stages/stage0_indexing.py`
- **FileScanner 클래스**:
  - `scan_folders()`: 다중 폴더 재귀 스캔
  - `_scan_folder()`: 단일 폴더 스캔 (확장자/크기 필터)
  - `_calculate_hash()`: XXHash 계산 (8KB 청크)
  - `_detect_encoding()`: chardet 인코딩 감지 (10KB 샘플)
  - `detect_duplicates()`: 해시 기반 중복 감지
  - `save_to_db()`: files 테이블 + processing_state 저장
  - `run()`: 전체 Stage 0 실행

- **필터링 규칙**:
  - 허용 확장자: `.txt`, `.epub`
  - 제외 확장자: `.exe`, `.bat`, `.json`, `.zip` 등
  - 최소 파일 크기: 512바이트

- **중복 처리**:
  - 동일 해시 파일 그룹화
  - 첫 번째 파일을 원본으로 지정
  - `is_duplicate=1`, `duplicate_of=원본ID` 설정

### 테스트 결과
```
✅ Total files found: 2,438
⚠️ Found 121 duplicate files
✅ Saved 2,438 files to database
```

## ✅ 완료 조건 (Definition of Done)

- [x] FileScanner 클래스 구현
- [x] XXHash 해싱 구현
- [x] chardet 인코딩 감지 구현
- [x] 중복 파일 감지 로직 구현
- [x] DB 저장 로직 구현
- [x] Test_Novels 폴더 테스트 성공 (2,438 files, 121 duplicates)

## 📝 진행 기록

| 날짜 | 내용 |
|:---|:---|
| 2026-02-12 | 이슈 생성 |
| 2026-02-12 | Stage 0 구현 완료, 테스트 성공 (2,438 files indexed) |
