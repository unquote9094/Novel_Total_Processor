## 🎓 배경 지식 (Context)

Stage 5는 TXT 파일을 EPUB 전자책으로 변환하는 단계입니다. EbookLib를 사용하여 EPUB2 포맷을 생성하고, 메타데이터와 표지를 삽입하며, CSS 스타일링을 적용합니다.

## 🎯 목표 (Goal)

1. EbookLib 기반 EPUB2 생성
2. 메타데이터 삽입 (제목/작가/장르/태그/출판사/날짜)
3. 표지 이미지 추가
4. CSS 스타일링 (한글 폰트, 단락 스타일)
5. 단일 챕터 HTML 변환
6. DB 저장 (epub_path, chapter_count)

## 🛠️ 기술적 계획 (Technical Plan)

### 구현된 모듈

#### `src/novel_total_processor/stages/stage5_epub.py`
- **EPUBGenerator 클래스**:
  - `create_epub()`: EPUB 파일 생성
  - `_set_metadata()`: 메타데이터 설정 (DC 표준)
  - `_add_cover()`: 표지 이미지 추가
  - `_read_text_file()`: TXT 파일 읽기 (인코딩 처리)
  - `_create_chapter()`: HTML 챕터 생성 (단락 분리)
  - `_get_output_path()`: 출력 파일명 생성
  - `save_to_db()`: novels + processing_state 업데이트

### EPUB 구조
```
novel.epub
├── META-INF/
├── OEBPS/
│   ├── cover.jpg (표지)
│   ├── style.css (스타일)
│   ├── chapter_01.xhtml (본문)
│   ├── toc.ncx (목차)
│   └── nav.xhtml (네비게이션)
└── mimetype
```

### 메타데이터
- **필수**: 제목, 언어(ko), 식별자
- **선택**: 작가, 장르, 태그, 출판사, 날짜

### CSS 스타일
- 한글 폰트 스택: Noto Sans KR, Malgun Gothic
- 줄 간격: 1.8
- 단락 들여쓰기: 1em
- 제목 중앙 정렬

## ✅ 완료 조건 (Definition of Done)

- [x] EPUBGenerator 클래스 구현
- [x] EbookLib 기반 EPUB2 생성
- [x] 메타데이터 설정 (DC 표준)
- [x] 표지 이미지 추가
- [x] CSS 스타일링
- [x] 단일 챕터 HTML 변환
- [x] DB 저장 (epub_path, chapter_count)
- [x] 테스트 스크립트 작성

## 📝 진행 기록

| 날짜 | 내용 |
|:---|:---|
| 2026-02-12 | 이슈 생성 |
| 2026-02-12 | EPUBGenerator 구현 완료 |
